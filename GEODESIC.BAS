0 SCREEN 2
10 LX=640:LY=200
20 PP=SQR(3)/2
30 UI=0:UM=6.283184:VI=0:VM=6.283184
40 DU=(UM-UI)/1000:DV=(VM-VI)/1000
50 INPUT "paramätre U et V initiaux ",U,V
100 INPUT "paramätre U et V initiaux ",U,V
105 GOSUB 1000:GOSUB 1100
107 XX=XP:YY=YP
110 INPUT "VITESSE INITIAL TU ET TV ";TU,TV
111 IF TU=0 AND TV=0 THEN 110
112 GOSUB 1200
113 MV=SQR(UX*UX+UY+UZ*UZ)*TU+SQR(VX*VX+VY+VZ*VZ)*TV
115 DT=2/MV
117 CLS:GOSUB 2000
120 FOR I=1 TO  5000
125 GOSUB 1500:GOSUB 1700
130 U=U+DT*TU:V=V+DT*TV
140 TU=TU+DT*GU:TV=TV+DT*GV
150 GOSUB 1000:GOSUB 1100
155 GOSUB 1200
157 N=(UY*VZ-UZ*VY)+(UZ*VX-UX*VZ)+(UX*VY-UY*VX)
158 IF N<0 THEN PSET (XP,VP):GOTO 170
160 LINE (XX,YY)-(XP,YP)
170 XX=XP:YY=YP
180 NEXT I:INPUT R$:END
1000 REM
1005 R1=80:R2=40
1010 X=COS(U)*(R1+R2*COS(V))
1020 Y=SIN(U)*(R1+R2*COS(V))
1030 Z=R2*SIN(V)
1040 RETURN
1100 REM
1120 XP=LX/2+(Y-X)*PP
1130 YP=(LY+X+Y)/2-Z
1140 RETURN
1200 REM
1220 US=U:VS=V:GOSUB 1000:X0=X:Y0=Y:Z0=Z
1230 U=U+DU:GOSUB 1000:X1=X:Y1=Y:Z1=Z
1240 U=US:V=V+DV:GOSUB 1000
1250 UX=(X1-X0)/DU:VX=(X-X0)/DV
1260 UY=(Y1-Y0)/DU:VY=(Y-Y0)/DV
1270 UZ=(Z1-Z0)/DU:VZ=(Z-Z0)/DV
1280 V=VS:RETURN
1500 REM
1520 U0=U:V0=V:GOSUB 1200
1530 U1=UX:U2=UY:U3=UZ
1540 V1=VX:V2=VY:V3=VZ
1550 U=U+DU:GOSUB 1200
1560 EX=(UX-U1)/DU:FX=(VX-V1)/DU
1570 EY=(UY-U2)/DU:FY=(VY-V2)/DU
1580 EZ=(UZ-U3)/DU:FZ=(VZ-V3)/DU
1590 U=U0:V=V0+DV:GOSUB 1200
1600 GX=(VX-V1)/DV
1610 GY=(VY-V2)/DV
1620 GZ=(VZ-V3)/DV
1630 V=V0:GOSUB 1200
1640 RETURN
1699 REM
1700 UU=UX*UX+UY*UY+UZ*UZ
1710 UV=UX*VX+UY*VY+UZ*VZ
1720 VV=VX*VX+VY*VY+VZ*VZ
1730 UE=UX*EX+UY*EY+UZ*EZ
1740 UF=UX*FX+UY*FY+UZ*FZ
1750 UG=UX*GX+UY*GY+UZ*GZ
1760 VE=VX*EX+VY*EY+VZ*EZ
1770 VF=VX*FX+VY*FY+VZ*FZ
1780 VG=VX*GX+VY*GY+VZ*GZ
1790 CU=-(TU*TU*UE+2*TU*TV*UF+TV*TV*UG)
1800 CV=-(TU*TU*VE+2*TU*TV*VF+TV*TV*VG)
1810 GU=(CU*VV*CV*UV)/(UU*VV-UV*UV)
1820 GV=(UU*CV-UV*CU)/(UU*VV-UV*UV)
1830 RETURN
1999 REM
2000 UU=U:VV=V:KU=80:KV=40:FOR U=UI TO UM STEP (UM-UI)/KU
2005 FOR V=VI TO VM STEP (VM-VI)/KV
2006 GOSUB 1200
2007 N=(UY*VZ-UZ*VY)+(UZ*VX-UX*VZ)+(UX*VY-UY*VX)
2008 IF N<0 THEN 2040
2010 GOSUB 1000:GOSUB 1100
2020 PSET (XP,YP)
2040 NEXT V:NEXT U:U=UU:V=VV:RETURN
